{
    "type": "controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "MyController"
    },
    "id": "ExtBox1-ext-gen7595",
    "designerId": "33d71790-9a50-480c-82ed-8e2d9660a2ee",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onViewportAfterRender",
                "fn": "onViewportAfterRender",
                "implHandler": [
                    "var toolBar = abstractcomponent.down(\"panel\").down(\"toolbar\");\r",
                    "\r",
                    "function loadReportHtml(){\r",
                    "    var progressBar=Ext.Msg.wait(\"\",\"提示\",{text:\"正在加载……\"});\r",
                    "    var flag = false;\r",
                    "    var params = [];\r",
                    "\r",
                    "    Ext.Array.forEach(toolBar.items.items, function(item, index, allItems) { \r",
                    "        //alert(item.rawValue);\r",
                    "        if(item.name==\"parameter\"){\r",
                    "            if((item.rawValue=='' || item.rawValue==null)&&item.id!=\"SUBREPORT_DIR|java.lang.String\"){\r",
                    "                flag = true;\t\t\t    \t\t\r",
                    "            }\t    \t\t\t\r",
                    "            params.push(item.id+\"|\"+item.rawValue);\r",
                    "        }\r",
                    "    }); \r",
                    "\r",
                    "    if(flag){\r",
                    "        alert(\"参数值不能为空!\");\r",
                    "    }else{\r",
                    "        //展示报表\r",
                    "        //alert(Ext.ireportCommon.reportId);\r",
                    "        $.ajax({\r",
                    "            type: \"POST\",\r",
                    "            url: \"../source/config/report-html.jsp\",\r",
                    "            data: \"reportId=\"+Ext.ireportCommon.reportId+\"&type=html&params=\"+params.join(\";\"),\r",
                    "            contentType: \"application/x-www-form-urlencoded; charset=UTF-8\",\r",
                    "            success: function(data){\r",
                    "                data = data.replace(new RegExp('font-size: 10px', 'g'), 'font-size: 14px');\r",
                    "                abstractcomponent.down(\"panel\").down(\"panel\").update(data);\r",
                    "\r",
                    "                var buttonBar = abstractcomponent.down(\"panel\").down(\"panel\").down(\"toolbar\");\r",
                    "                buttonBar.show();\r",
                    "                progressBar.hide();\r",
                    "\r",
                    "            }\r",
                    "        });\t\t    \t\t\t\r",
                    "    } \r",
                    "}\r",
                    "\r",
                    "\r",
                    "if(list.length > 0){\r",
                    "\r",
                    "    for(var i=0; i<list.length; i++){\r",
                    "\r",
                    "        var tdName = list[i].NAME;\r",
                    "        if(tdName==\"startTime\"){\r",
                    "            tdName = \"开始时间\";\r",
                    "        }else if(tdName==\"endTime\"){\r",
                    "            tdName = \"截止时间\";\r",
                    "        }else if(tdName==\"reportDate\"){\r",
                    "            tdName = \"巡检日期\";\r",
                    "        }\r",
                    "\r",
                    "\r",
                    "        if(list[i].TYPE.indexOf(\"Date\") != -1){\r",
                    "            //set value\r",
                    "            toolBar.add({\r",
                    "                xtype: 'textfield',\r",
                    "                name:'parameter',\r",
                    "                width:190,\r",
                    "                labelWidth:58,\r",
                    "                id:list[i].NAME+\"|\"+list[i].TYPE,               \r",
                    "                fieldLabel: tdName\r",
                    "            })\r",
                    "\r",
                    "        }else if(list[i].TYPE.indexOf(\"Time\") != -1){\r",
                    "            //set value\r",
                    "            if(tdName==\"开始时间\"){\r",
                    "                toolBar.add({\r",
                    "                    xtype: 'textfield',\r",
                    "                    name:'parameter',\r",
                    "                    width:190,\r",
                    "                    labelWidth:58,\r",
                    "                    id:list[i].NAME+\"|\"+list[i].TYPE,\r",
                    "                    value:Ext.Date.format(new Date(), \"Y-m-d\")+\" 00:00:00\",\r",
                    "                    fieldLabel: tdName\r",
                    "                })\r",
                    "            }\r",
                    "            /**\r",
                    "            else if(tdName==\"截止时间\"){\r",
                    "            toolBar.add({\r",
                    "            xtype: 'textfield',\r",
                    "            name:'parameter',\r",
                    "            width:160,\r",
                    "            labelWidth:70,\r",
                    "            id:list[i].NAME+\"|\"+list[i].TYPE,\r",
                    "            value:Ext.Date.format(new Date(), \"Y-m-d H:i:s\"),\r",
                    "            fieldLabel: tdName\r",
                    "            })\r",
                    "            }\r",
                    "            */\r",
                    "            else{\r",
                    "                toolBar.add({\r",
                    "                    xtype: 'textfield',\r",
                    "                    name:'parameter',\r",
                    "                    width:190,\r",
                    "                    labelWidth:58,\r",
                    "                    id:list[i].NAME+\"|\"+list[i].TYPE,\r",
                    "                    value:Ext.Date.format(new Date(), \"Y-m-d H:i:s\"),\r",
                    "                    fieldLabel: tdName\r",
                    "                })\r",
                    "            }\r",
                    "\r",
                    "\r",
                    "        }else{\r",
                    "            if(list[i].NAME==\"SUBREPORT_DIR\"){\r",
                    "\r",
                    "                toolBar.add({\r",
                    "                    xtype: 'textfield',\r",
                    "                    name:'parameter',\r",
                    "                    hidden:true,\r",
                    "                    id:list[i].NAME+\"|\"+list[i].TYPE,\r",
                    "                    value:list[i].DEFAULT,\r",
                    "                    fieldLabel: tdName\r",
                    "                });\r",
                    "\r",
                    "            }else if(list[i].NAME==\"reportDate\"){\r",
                    "\r",
                    "                toolBar.add({\r",
                    "                    xtype: 'textfield',\r",
                    "                    name:'parameter',\r",
                    "                    width:190,\r",
                    "                    labelWidth:58,\r",
                    "                    value:Ext.Date.format(new Date(), \"Y-m-d\"),\r",
                    "                    id:list[i].NAME+\"|\"+list[i].TYPE,\r",
                    "                    fieldLabel: tdName\r",
                    "                });\r",
                    "\r",
                    "            }else{\r",
                    "                toolBar.add({\r",
                    "                    xtype: 'textfield',\r",
                    "                    name:'parameter',\r",
                    "                    width:190,\r",
                    "                    labelWidth:58,\r",
                    "                    id:list[i].NAME+\"|\"+list[i].TYPE,\r",
                    "                    value:list[i].DEFAULT,\r",
                    "                    fieldLabel: tdName\r",
                    "                });\r",
                    "            }\r",
                    "        }\r",
                    "\r",
                    "        if(i == list.length-1){\r",
                    "            //添加查询按钮\r",
                    "            toolBar.add({\r",
                    "                xtype: 'tbseparator'\r",
                    "            },{\r",
                    "                text: '生成报表',\r",
                    "                icon: '../source/image/export.gif',\r",
                    "                handler: function () { \r",
                    "                    loadReportHtml(); \r",
                    "                } \r",
                    "\r",
                    "            });\r",
                    "\r",
                    "            //var queryBtn = $(\"<input type='button' value='生成报表' name='query_btn' id='query_btn' onclick='loadReportHtml()' />\");\r",
                    "\r",
                    "        }\r",
                    "\r",
                    "        toolBar.doLayout();\r",
                    "    }\r",
                    "}else{\r",
                    "    loadReportHtml();\r",
                    "}\r",
                    "\r",
                    ""
                ],
                "name": "afterrender",
                "scope": "me",
                "designer|targetType": "MyViewport",
                "designer|controlQuery": "viewport"
            },
            "designerId": "1a941f85-fab2-438f-aeae-be5e77f9f93c"
        }
    ]
}